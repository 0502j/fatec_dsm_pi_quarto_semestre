name: Build and publish mobile app

on:
  push:
    branches:
      - main
    paths:
      - mobile/**
      - .github/**
  workflow_dispatch:

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout into source code
        uses: actions/checkout@v2

      - name: Build Signed APK
        uses: victorbnl/build-signed-apk@v1.0.0
        with:
          keystore_b64: ${{ secrets.KEYSTORE_BASE }}
          keystore_password: ${{ secrets.KEYSTORE_PASSW }}
          key_alias: ${{ secrets.KEY_ALIAS }}
          key_password: ${{ secrets.KEY_PASSW }}
          gradlew_file: ./mobile/gradlew
          gradlew_dir: ./mobile

      # - name: Set up Java
      #   uses: actions/setup-java@v1
      #   with:
      #     java-version: 11
        
      # - name: Grant Gradlew execution permission
      #   run: chmod +x ./mobile/gradlew

      # - name: Build app
      #   run: cd ./mobile && ./g./radlew build && ls -la ./
      
      - name: Publish app to Github releases
        uses: xresloader/upload-to-github-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # file: ./mobile/app/build/outputs/apk/release/app-release-unsigned.apk
          file: ./mobile/app/build/outputs/apk/release/app-release.apk
          draft: false
